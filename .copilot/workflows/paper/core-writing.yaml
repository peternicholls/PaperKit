# .copilot/workflows/paper/core-writing.yaml
# Core Paper Writing Workflow
# Main paper writing workflow (plan → research → draft → refine → refs → assemble)

name: "core-writing"
display-name: "Core Paper Writing Workflow"
description: "Main paper writing workflow (plan → research → draft → refine → refs → assemble)"
version: "1.0"

entry-points:
  - "paper.plan"
  - "paper.research"
  - "paper.draft"

phases:
  - id: "plan"
    agent: "paper-architect"
    command: "plan"
    description: "Create detailed paper outline within sprint"
    inputs-from-user: false # uses existing setup
    outputs:
      - file: "output-drafts/outlines/"
      - file: "latex/sections/ (skeletons)"
    next:
      - "research"

  - id: "research"
    agent: "research-consolidator"
    command: "research"
    description: "Consolidate research into structured reference documents"
    inputs-from-user: true
    outputs:
      - file: "output-refined/research/"
      - memory: "research-index"
    next:
      - "draft"
      - "research (continue)" # loop for multiple research areas

  - id: "draft"
    agent: "section-drafter"
    command: "draft"
    description: "Draft individual section in LaTeX"
    type: "loop"
    loop-condition: "sections-remain"
    inputs-from-user: true
    outputs:
      - file: "output-drafts/sections/"
      - memory: "section-status"
    next:
      - "draft (next-section)"
      - "optional-feedback"
      - "refine"

  - id: "optional-feedback"
    agent: "tutor"
    command: "tutor-feedback"
    description: "Get feedback on draft before refinement (optional)"
    inputs-from-user: false # user initiates
    outputs:
      - file: "planning/YYYYMMDD-*/tutor-feedback.md"
    next:
      - "refine"
    skip-if: "user-declines-feedback"

  - id: "refine"
    agent: "quality-refiner"
    command: "refine"
    description: "Improve draft for clarity, coherence, and academic quality"
    type: "loop"
    loop-condition: "refinement-cycles-needed"
    inputs-from-user: true
    outputs:
      - file: "output-refined/sections/"
      - memory: "section-status"
    next:
      - "refine (next-cycle)"
      - "manage-references"

  - id: "manage-references"
    agent: "reference-manager"
    command: "refs"
    description: "Validate and format bibliography"
    inputs-from-user: false
    outputs:
      - file: "latex/references/references.bib"
    next:
      - "assemble"

  - id: "assemble"
    agent: "latex-assembler"
    command: "assemble"
    description: "Integrate sections and compile to PDF"
    inputs-from-user: false
    outputs:
      - file: "latex/main.tex (integrated)"
      - file: "output-final/pdf/main.pdf"
    next:
      - "END"
    requires-consent: true
    tools-used:
      - "lint-latex.sh"
      - "validate-structure.py"
      - "build-latex.sh"

typical-duration: "Varies by content and refinement cycles"
can-resume: true
supports-partial-completion: true # can skip sections, come back later
