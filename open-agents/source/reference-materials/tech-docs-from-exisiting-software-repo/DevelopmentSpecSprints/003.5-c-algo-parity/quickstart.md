# Quickstart

1. **Install toolchains**
   - C (required): `clang` or `gcc` with C99 support. Verify with `cc --version` and `cc -std=c99 -v`. Run `make test-c` from repo root to confirm the C harness builds and tests pass.
   - Swift (optional for wrapper tests): Xcode 15 / Swift 5.9 for `swift test`.

2. **Build C reference binary**
   - Preferred: `make test-c` (verifies the core math and produces C artifacts).
   - Direct build (for parity emitter): `gcc -std=c99 Sources/CColorJourney/ColorJourney.c -I Sources/CColorJourney/include -lm -o .build/parity-c-ref`.

3. **Prepare corpus**
   - Add/inspect JSON fixtures under `specs/005-c-algo-parity/corpus/`.
   - Each case includes anchors, config, seed, and expected count.
   - See `corpus/schema.json` for the complete format specification.

4. **Run parity suite**
   - Build the C parity runner: `make -C specs/003.5-c-algo-parity/tools/parity-runner parity-runner`.
   - Execute the binary against the corpus:
     ```bash
     ./specs/003.5-c-algo-parity/tools/parity-runner/parity-runner \
       --corpus specs/003.5-c-algo-parity/corpus/default.json \
       --tolerances specs/003.5-c-algo-parity/config/tolerances.example.json \
       --artifacts specs/003.5-c-algo-parity/artifacts/<runId>/
     ```

5. **CLI Options**

   **Required:**
   - `--corpus <file>`: Path to corpus JSON file
   - `--tolerances <file>`: Path to tolerance configuration JSON

   **Optional:**
   - `--artifacts <dir>`: Output directory for run artifacts (default: `./artifacts/<auto-generated-id>/`)
   - `--cases <id1,id2>`: Comma-separated list of case IDs to run (default: all)
   - `--tags <tag1,tag2>`: Filter cases by tags
   - `--c-runner <path>`: Path to canonical C engine binary (default: auto-detect)
   - `--alt-runner <path>`: Path to alternate engine binary (default: auto-detect)
   - `--run-id <id>`: Custom run identifier (default: timestamp-based UUID)
   - `--c-commit <hash>`: Canonical engine git commit for provenance
   - `--wasm-commit <hash>`: Alternate engine git commit for provenance
   - `--pass-gate <0-1>`: Required pass rate (0.0-1.0, default: 0.95)
   - `--max-duration-ms <ms>`: Maximum run duration in milliseconds (default: 600000 = 10 minutes)
   - `--platform <name>`: Platform identifier for provenance (default: auto-detect)
   - `--tolerance-deltaE <val>`: Override deltaE tolerance
   - `--tolerance-l <val>`: Override L channel absolute tolerance
   - `--tolerance-a <val>`: Override a channel absolute tolerance
   - `--tolerance-b <val>`: Override b channel absolute tolerance
   - `--artifact-policy <all|failures|none>`: Control artifact retention (default: failures)

6. **Example Usage**

   **Basic run:**
   ```bash
   ./specs/005-c-algo-parity/tools/parity-runner/parity-runner \
     --corpus corpus/default.json \
     --tolerances config/tolerances.example.json
   ```

   **Run specific cases with custom tolerances:**
   ```bash
   ./specs/005-c-algo-parity/tools/parity-runner/parity-runner \
     --corpus corpus/default.json \
     --tolerances config/tolerances.example.json \
     --cases baseline_monochrome,boundary_extreme_chroma \
     --tolerance-deltaE 1.0 \
     --artifact-policy all
   ```

   **Filter by tags:**
   ```bash
   ./specs/005-c-algo-parity/tools/parity-runner/parity-runner \
     --corpus corpus/edge-cases.json \
     --tolerances config/tolerances.example.json \
     --tags boundary,extreme
   ```

   **CI/CD integration with provenance:**
   ```bash
   ./specs/005-c-algo-parity/tools/parity-runner/parity-runner \
     --corpus corpus/default.json \
     --tolerances config/tolerances.example.json \
     --c-commit $(git rev-parse HEAD) \
     --wasm-commit $(git rev-parse HEAD) \
     --platform "GitHub Actions Ubuntu 22.04" \
     --pass-gate 0.95 \
     --max-duration-ms 600000
   ```

7. **Review results**
   - Open the generated report JSON in `artifacts/<runId>/report.json` for summary
   - Inspect per-case artifacts for failures in `artifacts/<runId>/<caseId>/`
   - Each failure includes:
     - `inputs.json`: Original input case
     - `c_output.json`: Canonical engine output
     - `alt_output.json`: Alternate engine output
     - `deltas.json`: Per-color OKLab and deltaE differences
     - `hints.json`: Top contributors and stage/parameter analysis
     - `metadata.json`: Provenance (commits, build flags, corpus version)

8. **Report format**
   - Reports follow the schema defined in `contracts/parity-api.yaml`
   - Key sections:
     - `summary`: Total/passed/failed counts, pass rate, duration
     - `provenance`: Commits, build flags, platform, corpus/tolerance versions
     - `histograms`: Distribution of deltaE and per-channel deltas
     - `topContributors`: Cross-case analysis of failure patterns
     - `results[]`: Per-case status with artifact paths

9. **Troubleshooting**
   - **Build failures**: Ensure C99 toolchain is properly installed and `make test-c` passes
   - **Missing runners**: Check that both canonical and alternate binaries exist or specify paths explicitly
   - **Tolerance violations**: Review `deltas.json` and `hints.json` for failing cases
   - **Performance issues**: Use `--cases` or `--tags` to run subsets; check `--max-duration-ms`
   - **Provenance tracking**: Always specify `--c-commit` and `--wasm-commit` in CI for reproducibility

---

## Phase 9: Swift Wrapper Parity Testing

**Status**: Specification complete, ready for implementation  
**Documentation**: [phase-9-swift-parity.md](phase-9-swift-parity.md)

Phase 9 validates the Swift wrapper layer (`Sources/ColorJourney/*`) using the same methodology as C parity testing.

**Quick Start for Phase 9**:
```bash
# 1. Review the specification
cat phase-9-swift-parity.md

# 2. Start implementing tasks (T051-T079)
cat phase-9-tasks.md

# 3. Reference the API contract
cat contracts/swift-wrapper-parity-api.yaml

# 4. Understand the implementation roadmap
cat PHASE-9-SPEC-SUMMARY.md
```

**Key Phase 9 Documents**:
- [phase-9-swift-parity.md](phase-9-swift-parity.md) - Complete test strategy and architecture
- [phase-9-tasks.md](phase-9-tasks.md) - 29 implementation tasks (T051-T079)
- [PHASE-9-SPEC-SUMMARY.md](PHASE-9-SPEC-SUMMARY.md) - Executive summary and roadmap
- [INDEX.md](INDEX.md) - Complete reference index for all documentation
