# Validate Citations Workflow Definition
# Part of PaperKit Core Workflows
# Enhanced citation validation with Harvard style checking

name: validate-citations
displayName: Validate Citations
description: >
  Comprehensive citation validation against BibTeX database.
  Checks for missing entries, incomplete fields, orphaned references,
  and Harvard style compliance.
version: 2.0.0
module: core
category: references
path: .paper/_cfg/workflows/validate-citations.yaml

agents:
  - reference-manager

dependencies:
  files:
    - .paper/_cfg/guides/harvard-citation-guide.md
    - .paper/_cfg/tools/citation-rules.yaml
    - latex/references/references.bib

steps:
  - name: load-rules
    agent: reference-manager
    description: Load Harvard citation guide and validation rules

  - name: scan-citations
    agent: reference-manager
    description: >
      Scan all LaTeX files for citation commands including
      \cite{}, \citep{}, \citet{}, \citeauthor{}, and [CITATION NEEDED] markers

  - name: parse-bibtex
    agent: reference-manager
    description: Parse BibTeX database and extract all entries

  - name: match-citations
    agent: reference-manager
    description: >
      Match each citation to its BibTeX entry.
      Identify missing entries and orphaned bibliography items.

  - name: validate-completeness
    agent: reference-manager
    description: >
      Check each BibTeX entry has all required fields for its type.
      Apply validation rules from citation-rules.yaml.

  - name: check-format
    agent: reference-manager
    description: >
      Verify Harvard style compliance: author format, title case,
      page numbers for quotes, access dates for online sources.

  - name: generate-report
    agent: reference-manager
    description: >
      Generate detailed validation report with statistics,
      categorized issues (errors, warnings, info), and recommendations.

inputSchema:
  type: object
  properties:
    texFiles:
      type: array
      description: "List of LaTeX files to scan (default: all in latex/sections/)"
      items:
        type: string
    bibFile:
      type: string
      description: Path to BibTeX file
      default: latex/references/references.bib
    strictMode:
      type: boolean
      description: Treat warnings as errors
      default: false
    autoFix:
      type: boolean
      description: Automatically fix simple formatting issues
      default: false
    outputFormat:
      type: string
      description: Report format
      enum: [markdown, yaml, json]
      default: markdown

outputSchema:
  type: object
  properties:
    success:
      type: boolean
      description: Whether validation passed (no errors)
    statistics:
      type: object
      properties:
        totalCitations:
          type: integer
        uniqueCitations:
          type: integer
        bibEntries:
          type: integer
        matchRate:
          type: number
        errorCount:
          type: integer
        warningCount:
          type: integer
    errors:
      type: array
      description: Critical issues that must be fixed
      items:
        type: object
        properties:
          id:
            type: string
          type:
            type: string
          key:
            type: string
          message:
            type: string
          location:
            type: string
          fix:
            type: string
    warnings:
      type: array
      description: Issues that should be addressed
      items:
        type: object
    info:
      type: array
      description: Suggestions for improvement
      items:
        type: object
    reportPath:
      type: string
      description: Path to generated validation report

exampleUsage:
  - "Validate all citations in paper"
  - "Check references in introduction section"
  - "Run strict validation before submission"
  - "Auto-fix formatting issues in bibliography"

owner: core-team
